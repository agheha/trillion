<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.momstudy.repository.dao.BoardDAO">
         <resultMap type="Board" id="boardMap">
         <result column="num" property="num" />
         <result column="title" property="title" />
         <result column="content" property="content" />
         <result column="reg_date" property="regDate" />
         <result column="email" property="email" />
         <result column="study_no" property="studyNo" />
         <result column="type" property="type" />
         <result column="notice" property="notice" />
         <result column="see_cnt" property="seeCnt" />
         <result column="comment_group_code" property="commentGroupCode" />
</resultMap>

<!-- 자유게시판  리스트! -->
<select id="selectBoard" resultMap="boardMap" parameterType="Search" flushCache="true" useCache="true">
		<!--   
		select *
		from tb_free_board
		order by 
		type asc, num desc
		
		-->
	select *
		from (select rownum rnum , a.*,
		             count(*) over() as cnt
		        from ( select *
	                 from tb_free_board
	               <where>
	               <choose>
	                 <when test="type == 'email'">
	                    and email like '%'||#{keyword}||'%'
	                 </when>
	                 <when test="type == 'title'">
	                  	and title like '%'||#{keyword}||'%'
	                 </when>
	               </choose>           
	               </where>   
	                 	  order by notice asc,
	                  <if test="filter == 'regDate'">
	                 	     reg_date desc,
	                  </if>
	                  num desc) a)
		where rnum between #{begin} and #{end}
	</select>

	
<!-- 글 상세 조회 -->
<select id="selectOneBoard" parameterType="int" resultMap="boardMap">
   select *
   from tb_free_board
   where num = #{num}
</select>

<!-- 글 등록  -->
<!-- 일반게시글 일 경우 -->
<insert id="insertBoard" parameterType="Board"> <!-- 그룹코드 시퀀스로 네스트발해서 -->
insert into tb_free_board (num, title, content, email) 
values (seq_free_board_num.nextval, #{title}, #{content}, #{email})
</insert>

<!-- 공지사항글 체크 시 -->
<insert id="insertBoard2" parameterType="Board">
insert into tb_free_board (num, title, content, email, type, notice)
values (seq_boardtype_no.nextval, #{title}, #{content}, #{email}, #{type}, #{notice})
</insert>

<!-- 글 수정 -->
<update id="updateBoard" parameterType="Board">
 update tb_free_board
    set title = #{title},
       content = #{content}
       where num = #{num}  
</update>
<!-- 글 조회 수 -->
<update id="updateSeeCnt" parameterType="int">
 update tb_free_board
   set
   see_cnt = see_cnt + 1
   where num = #{num}
</update>
<!-- 글 삭제 -->
<delete id="deleteBoard" parameterType="int">
   delete
     from tb_free_board
     where
     num = #{num}
</delete>

</mapper>